#!/bin/bash

# Task 0: API Request Automation
# Objective: Automate the process of making API requests to the PokÃ©mon API
# and saving the results to a file

# API endpoint for Pikachu
API_URL="https://pokeapi.co/api/v2/pokemon/pikachu"
OUTPUT_FILE="data.json"
ERROR_FILE="errors.txt"

# Clear previous error file if it exists
> "$ERROR_FILE"

# Make the API request and handle the response
echo "Making API request to: $API_URL"
echo "Fetching data for Pikachu..."

# Use curl to make the API request with proper error handling
if curl -s -f "$API_URL" -o "$OUTPUT_FILE" 2>> "$ERROR_FILE"; then
    # Check if the response is valid JSON and not empty
    if [ -s "$OUTPUT_FILE" ] && jq empty "$OUTPUT_FILE" 2>> "$ERROR_FILE"; then
        echo "âœ… Success! Data saved to $OUTPUT_FILE"
        
        # Display sample output (first 50 lines formatted with jq)
        echo ""
        echo "Sample output (first 50 lines):"
        echo "--------------------------------"
        jq . < "$OUTPUT_FILE" | head -n 50
        
        # Show basic stats
        echo ""
        echo "ðŸ“Š File Info:"
        echo "   File size: $(wc -c < "$OUTPUT_FILE") bytes"
        echo "   PokÃ©mon: Pikachu"
        echo "   Download successful!"
    else
        echo "âŒ Error: Invalid or empty JSON response" | tee -a "$ERROR_FILE"
        echo "Check $ERROR_FILE for details"
    fi
else
    echo "âŒ Error: Failed to fetch data from the API" | tee -a "$ERROR_FILE"
    echo "Check $ERROR_FILE for details"
    echo "You might want to check:"
    echo "  1. Your internet connection"
    echo "  2. If the API is available (https://pokeapi.co)"
    echo "  3. If 'pikachu' is a valid PokÃ©mon name"
fi
